<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP                #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell    #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns       #-}</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusTx.AsData</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.AsData.html#asData"><span class="hs-identifier">asData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.AsData.html#asDataFor"><span class="hs-identifier">asDataFor</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ifor</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Traversable</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype.TyVarBndr</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Builtins.html"><span class="hs-identifier">PlutusTx.Builtins</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builtins</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.IsData.Class.html"><span class="hs-identifier">PlutusTx.IsData.Class</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.IsData.TH.html"><span class="hs-identifier">PlutusTx.IsData.TH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.IsData.TH.html#mkConstrCreateExpr"><span class="hs-identifier">mkConstrCreateExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.IsData.TH.html#mkUnsafeConstrMatchPattern"><span class="hs-identifier">mkUnsafeConstrMatchPattern</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">{- | 'asData' takes a datatype declaration and &quot;backs it&quot; by 'BuiltinData'. It does
this by replacing the datatype with a newtype around 'BuiltinData', and providing
pattern synonyms that match the behaviour of the original datatype.

Since 'BuiltinData' can only contain 'BuiltinData', the pattern synonyms
encode and decode all the fields using 'toBuiltinData' and 'unsafeFromBuiltinData'.
That means that these operations are called on every pattern match or construction.
This *can* be very efficient if, for example, the datatypes for the fields have
also been defined with 'asData', and so have trivial conversions to/from 'BuiltinData'
(or have very cheap conversions, like 'Integer' and 'ByteString').
But it can be very expensive otherwise, so take care.

Deriving clauses are transferred from the quoted declaration to the generated newtype
declaration. Note that you may therefore need to do strange things like use
@deriving newtype@ on a data declaration.

Example:
@
    $(asData
      [d|
        data Example a = Ex1 Integer | Ex2 a a
          deriving newtype (Eq)
      |]
@
becomes
@
    newtype Example a = Example BuiltinData
      deriving newtype (Eq)

    pattern Ex1 :: (ToData a, UnsafeFromData a) =&gt; Integer -&gt; Example a
    pattern Ex1 i &lt;- Example (unsafeDataAsConstr -&gt; ((==) 0 -&gt; True, [unsafeFromBuiltinData -&gt; i]))
      where Ex1 i = Example (mkConstr 0 [toBuiltinData i])

    pattern Ex2 :: (ToData a, UnsafeFromData a) =&gt; a -&gt; a -&gt; Example a
    pattern Ex2 a1 a2 &lt;- Example (unsafeDataAsConstr -&gt; ((==) 1 -&gt; True, [unsafeFromBuiltinData -&gt; a1, unsafeFromBuiltinData -&gt; a2]))
      where Ex2 a1 a2 = Example (mkConstr 1 [toBuiltinData a1, toBuiltinData a2])

    {-# COMPLETE Ex1, Ex2 #-}
@
-}</span><span>
</span><span id="line-66"></span><span class="annot"><a href="PlutusTx.AsData.html#asData"><span class="hs-identifier hs-type">asData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span id="asData"><span class="annot"><span class="annottext">asData :: Q [Dec] -&gt; Q [Dec]
</span><a href="PlutusTx.AsData.html#asData"><span class="hs-identifier hs-var hs-var">asData</span></a></span></span><span> </span><span id="local-6989586621679747575"><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679747575"><span class="hs-identifier hs-var">decQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621679747574"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679747574"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679747575"><span class="hs-identifier hs-var">decQ</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621679747573"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679747573"><span class="hs-identifier hs-var">outputDecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679747574"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Q [Dec]
</span><a href="PlutusTx.AsData.html#asDataFor"><span class="hs-identifier hs-var">asDataFor</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679747573"><span class="hs-identifier hs-var">outputDecs</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><a href="PlutusTx.AsData.html#asDataFor"><span class="hs-identifier hs-type">asDataFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span id="asDataFor"><span class="annot"><span class="annottext">asDataFor :: Dec -&gt; Q [Dec]
</span><a href="PlutusTx.AsData.html#asDataFor"><span class="hs-identifier hs-var hs-var">asDataFor</span></a></span></span><span> </span><span id="local-6989586621679747570"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679747570"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-comment">-- th-abstraction doesn't include deriving clauses, so we have to handle that here</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679747569"><span class="annot"><span class="annottext">derivs :: [DerivClause]
</span><a href="#local-6989586621679747569"><span class="hs-identifier hs-var hs-var">derivs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679747570"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.DataD</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679747567"><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679747567"><span class="hs-identifier hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679747567"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621679747566"><span class="annot"><span class="annottext">di :: DatatypeInfo
</span><a href="#local-6989586621679747566"><span class="hs-identifier hs-var">di</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">datatypeVariant :: DatatypeInfo -&gt; DatatypeVariant
</span><span class="hs-identifier hs-var">TH.datatypeVariant</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747563"><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679747563"><span class="hs-identifier hs-var">dVariant</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeCons :: DatatypeInfo -&gt; [ConstructorInfo]
</span><span class="hs-identifier hs-var">TH.datatypeCons</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747561"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679747561"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeName :: DatatypeInfo -&gt; Name
</span><span class="hs-identifier hs-var">TH.datatypeName</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747559"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747559"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeVars :: DatatypeInfo -&gt; [TyVarBndr ()]
</span><span class="hs-identifier hs-var">TH.datatypeVars</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747557"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679747557"><span class="hs-identifier hs-var">tTypeVars</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Q DatatypeInfo
</span><span class="hs-identifier hs-var">TH.normalizeDec</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679747570"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-comment">-- Other stuff is data families and so on</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679747563"><span class="hs-identifier hs-var">dVariant</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><span class="hs-identifier hs-var">TH.Datatype</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asData: can't handle datatype variant &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679747563"><span class="hs-identifier hs-var">dVariant</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">-- a fresh name for the new datatype, but same lexically as the old one</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679747553"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747553"><span class="hs-identifier hs-var">cname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.newName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747559"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- The newtype declaration</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679747552"><span class="annot"><span class="annottext">ntD :: Dec
</span><a href="#local-6989586621679747552"><span class="hs-identifier hs-var hs-var">ntD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679747551"><span class="annot"><span class="annottext">con :: Con
</span><a href="#local-6989586621679747551"><span class="hs-identifier hs-var hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.NormalC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747553"><span class="hs-identifier hs-var">cname</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.Bang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.NoSourceUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.NoSourceStrictness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BuiltinData</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Cxt
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Kind
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.NewtypeD</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747559"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679747557"><span class="hs-identifier hs-var">tTypeVars</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679747551"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679747569"><span class="hs-identifier hs-var">derivs</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- The pattern synonyms, one for each constructor</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679747544"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679747544"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679747561"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679747543"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679747543"><span class="hs-identifier hs-var">conIx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">constructorName :: ConstructorInfo -&gt; Name
</span><span class="hs-identifier hs-var">TH.constructorName</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747540"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747540"><span class="hs-identifier hs-var">conName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorFields :: ConstructorInfo -&gt; Cxt
</span><span class="hs-identifier hs-var">TH.constructorFields</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747538"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679747538"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorVariant :: ConstructorInfo -&gt; ConstructorVariant
</span><span class="hs-identifier hs-var">TH.constructorVariant</span></span><span class="hs-glyph">=</span><span id="local-6989586621679747536"><span class="annot"><span class="annottext">ConstructorVariant
</span><a href="#local-6989586621679747536"><span class="hs-identifier hs-var">cVariant</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- If we have a record constructor, we need to reuse the names for the</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- matching part of the pattern synonym</span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679747535"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747535"><span class="hs-identifier hs-var">fieldNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConstructorVariant
</span><a href="#local-6989586621679747536"><span class="hs-identifier hs-var">cVariant</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">TH.RecordConstructor</span></span><span> </span><span id="local-6989586621679747533"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747533"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747533"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-comment">-- otherwise whatever</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">ConstructorVariant
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679747538"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679747532"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679747532"><span class="hs-identifier hs-var">fieldIx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.newName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679747532"><span class="hs-identifier hs-var">fieldIx</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679747531"><span class="annot"><span class="annottext">extractFieldNames :: [Name]
</span><a href="#local-6989586621679747531"><span class="hs-identifier hs-var hs-var">extractFieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747535"><span class="hs-identifier hs-var">fieldNames</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679747530"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747530"><span class="hs-identifier hs-var">createFieldNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747535"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.newName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621679747528"><span class="annot"><span class="annottext">Q PatSynArgs
</span><a href="#local-6989586621679747528"><span class="hs-identifier hs-var">patSynArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConstructorVariant
</span><a href="#local-6989586621679747536"><span class="hs-identifier hs-var">cVariant</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">ConstructorVariant
</span><span class="hs-identifier hs-var">TH.NormalConstructor</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; [Name] -&gt; m PatSynArgs
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.prefixPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747531"><span class="hs-identifier hs-var">extractFieldNames</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">TH.RecordConstructor</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; [Name] -&gt; m PatSynArgs
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.recordPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747531"><span class="hs-identifier hs-var">extractFieldNames</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">ConstructorVariant
</span><span class="hs-identifier hs-var">TH.InfixConstructor</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747531"><span class="hs-identifier hs-var">extractFieldNames</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621679747525"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747525"><span class="hs-identifier hs-var">f1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679747524"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747524"><span class="hs-identifier hs-var">f2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; Name -&gt; m PatSynArgs
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.infixPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747525"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747524"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asData: infix data constructor with other than two fields&quot;</span></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621679747518"><span class="annot"><span class="annottext">pat :: Q Pat
</span><a href="#local-6989586621679747518"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; [m Pat] -&gt; m Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.conP</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747553"><span class="hs-identifier hs-var">cname</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; [Name] -&gt; Q Pat
</span><a href="PlutusTx.IsData.TH.html#mkUnsafeConstrMatchPattern"><span class="hs-identifier hs-var">mkUnsafeConstrMatchPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679747543"><span class="hs-identifier hs-var">conIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747531"><span class="hs-identifier hs-var">extractFieldNames</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>      </span><span id="local-6989586621679747512"><span class="annot"><span class="annottext">createExpr :: Q Exp
</span><a href="#local-6989586621679747512"><span class="hs-identifier hs-var hs-var">createExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">TH.conE</span><span> </span><span class="hs-identifier">cname</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">mkConstrCreateExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">conIx</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">createFieldNames</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621679747506"><span class="annot"><span class="annottext">clause :: Q Clause
</span><a href="#local-6989586621679747506"><span class="hs-identifier hs-var hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
[m Pat] -&gt; m Body -&gt; [m Dec] -&gt; m Clause
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.varP</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679747530"><span class="hs-identifier hs-var">createFieldNames</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m Body
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.normalB</span></a></span><span> </span><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679747512"><span class="hs-identifier hs-var">createExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621679747503"><span class="annot"><span class="annottext">patSynD :: Q Dec
</span><a href="#local-6989586621679747503"><span class="hs-identifier hs-var hs-var">patSynD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
Name -&gt; m PatSynArgs -&gt; m PatSynDir -&gt; m Pat -&gt; m Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.patSynD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747540"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Q PatSynArgs
</span><a href="#local-6989586621679747528"><span class="hs-identifier hs-var">patSynArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; [m Clause] -&gt; m PatSynDir
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.explBidir</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Q Clause
</span><a href="#local-6989586621679747506"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Q Pat
</span><a href="#local-6989586621679747518"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-115"></span><span>      </span><span id="local-6989586621679747502"><span class="annot"><span class="annottext">dataConstraints :: Kind -&gt; Cxt
</span><a href="#local-6989586621679747502"><span class="hs-identifier hs-var hs-var">dataConstraints</span></a></span></span><span> </span><span id="local-6989586621679747501"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747501"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ToData</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747501"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">UnsafeFromData</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747501"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>      </span><span id="local-6989586621679747497"><span class="annot"><span class="annottext">ctxFor :: t (TyVarBndr_ flag) -&gt; Cxt
</span><a href="#local-6989586621679747497"><span class="hs-identifier hs-var hs-var">ctxFor</span></a></span></span><span> </span><span id="local-6989586621679747496"><span class="annot"><span class="annottext">t (TyVarBndr_ flag)
</span><a href="#local-6989586621679747496"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Cxt
</span><a href="#local-6989586621679747502"><span class="hs-identifier hs-var">dataConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">TH.tvName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (TyVarBndr_ flag)
</span><a href="#local-6989586621679747496"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-comment">-- Try and be a little clever and only add constraints on the variables</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- used in the arguments</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679747492"><span class="annot"><span class="annottext">varsInArgs :: [TyVarBndr ()]
</span><a href="#local-6989586621679747492"><span class="hs-identifier hs-var hs-var">varsInArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndr ()]
</span><span class="hs-identifier hs-var">TH.freeVariablesWellScoped</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679747538"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679747489"><span class="annot"><span class="annottext">ctxForArgs :: Cxt
</span><a href="#local-6989586621679747489"><span class="hs-identifier hs-var hs-var">ctxForArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *} {flag}.
Foldable t =&gt;
t (TyVarBndr_ flag) -&gt; Cxt
</span><a href="#local-6989586621679747497"><span class="hs-identifier hs-var">ctxFor</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679747492"><span class="hs-identifier hs-var">varsInArgs</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679747487"><span class="annot"><span class="annottext">conTy :: Kind
</span><a href="#local-6989586621679747487"><span class="hs-identifier hs-var hs-var">conTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679747485"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747485"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621679747484"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747484"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747485"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747484"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Kind
</span><span class="hs-identifier hs-var">TH.datatypeType</span></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679747566"><span class="hs-identifier hs-var">di</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679747538"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span id="local-6989586621679747481"><span class="annot"><span class="annottext">allFreeVars :: [TyVarBndr ()]
</span><a href="#local-6989586621679747481"><span class="hs-identifier hs-var hs-var">allFreeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndr ()]
</span><span class="hs-identifier hs-var">TH.freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747487"><span class="hs-identifier hs-var">conTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>      </span><span id="local-6989586621679747480"><span class="annot"><span class="annottext">fullTy :: Kind
</span><a href="#local-6989586621679747480"><span class="hs-identifier hs-var hs-var">fullTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall newFlag oldFlag.
newFlag -&gt; [TyVarBndr_ oldFlag] -&gt; [TyVarBndr_ newFlag]
</span><span class="hs-identifier hs-var">TH.changeTVFlags</span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.SpecifiedSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679747481"><span class="hs-identifier hs-var">allFreeVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679747489"><span class="hs-identifier hs-var">ctxForArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747487"><span class="hs-identifier hs-var">conTy</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621679747475"><span class="annot"><span class="annottext">patSynSigD :: Q Dec
</span><a href="#local-6989586621679747475"><span class="hs-identifier hs-var hs-var">patSynSigD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.PatSynSigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679747540"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679747480"><span class="hs-identifier hs-var">fullTy</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Q Dec
</span><a href="#local-6989586621679747475"><span class="hs-identifier hs-var">patSynSigD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Q Dec
</span><a href="#local-6989586621679747503"><span class="hs-identifier hs-var">patSynD</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-comment">-- A complete pragma, to top it off</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679747471"><span class="annot"><span class="annottext">compl :: Dec
</span><a href="#local-6989586621679747471"><span class="hs-identifier hs-var hs-var">compl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pragma -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.PragmaD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Maybe Name -&gt; Pragma
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.CompleteP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><span class="hs-identifier hs-var">TH.constructorName</span></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679747561"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679747552"><span class="hs-identifier hs-var">ntD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679747471"><span class="hs-identifier hs-var">compl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679747544"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-130"></span></pre></body></html>